# チケット #004: AI質問生成機能

## 概要
Google Gemini APIを使用して、日記内容から3つの深掘り質問を自動生成する機能

## 受け入れ条件
- 日記送信後、自動的に3つの質問が生成されること
- 質問がマインドマップ上にノードとして表示されること
- API失敗時はフォールバック質問が表示されること
- 生成中はローディング表示があること

## タスクリスト

### Gemini API連携
- [x] Google Generative AI SDKのセットアップ
- [x] APIキー管理の実装（環境変数）
- [x] Geminiクライアントの初期化
- [x] プロンプトエンジニアリング

### 質問生成サービス
- [x] QuestionGeneratorサービスの作成
- [x] 質問生成関数の実装
- [x] レート制限対策の実装
- [x] タイムアウト処理（30秒）の実装
- [x] リトライロジックの実装

### キャッシュ機能
- [ ] 質問キャッシュの実装
- [ ] 同一内容のキャッシュヒット判定
- [ ] キャッシュ有効期限の設定

### エラーハンドリング
- [x] API失敗時のフォールバック質問生成
- [x] エラー通知の表示
- [x] ネットワークエラーの処理

### UI更新
- [x] ローディングスピナーの実装
- [x] 質問ノードの動的追加アニメーション
- [x] エラー状態の表示

## 技術的詳細

### プロンプト設計
```typescript
const prompt = `
以下の日記内容を読んで、書いた人の感情や思考を深掘りするための
質問を3つ生成してください。質問は開かれた質問で、
自己理解を促すものにしてください。

日記内容：
${diaryContent}

質問は以下の形式でJSON配列として返してください：
["質問1", "質問2", "質問3"]
`;
```

### フォールバック質問
```typescript
const fallbackQuestions = [
  "今日の出来事で最も印象に残ったことは何ですか？",
  "この経験から学んだことは何ですか？",
  "明日はどんな一日にしたいですか？"
];
```

### API設定
- モデル: gemini-pro
- 温度: 0.7
- 最大トークン数: 500

## 依存関係
- チケット#003（マインドマップ表示）が完了していること
- Gemini APIキーが取得済みであること

## 備考
- APIキーは設定画面から入力可能にする
- 質問は日本語で生成
- 1日のAPI呼び出し回数に制限がある場合は考慮